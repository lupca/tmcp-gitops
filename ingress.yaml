# ingress.yaml â€“ Traefik IngressRoute with StripPrefix

# Middleware: strip /pb prefix
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: strip-pb
spec:
  stripPrefix:
    prefixes: ["/pb"]
---
# Middleware: strip /hub prefix
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: strip-hub
spec:
  stripPrefix:
    prefixes: ["/hub"]
---
# Middleware: strip /api/agent prefix
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: strip-api-agent
spec:
  stripPrefix:
    prefixes: ["/api/agent"]
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: marketing-ingress
spec:
  entryPoints: [web]
  routes:
  # PocketBase API & Admin
  - match: PathPrefix(`/pb`)
    kind: Rule
    middlewares:
    - name: strip-pb
    services:
    - name: pb-service
      port: 80
  # Agent API
  - match: PathPrefix(`/api/agent`)
    kind: Rule
    middlewares:
    - name: strip-api-agent
    services:
    - name: agent-service
      port: 80
  # Marketing Hub SPA
  - match: PathPrefix(`/hub`)
    kind: Rule
    middlewares:
    - name: strip-hub
    services:
    - name: hub-service
      port: 80
  # Blog (catch-all)
  - match: PathPrefix(`/`)
    kind: Rule
    services:
    - name: blog-service
      port: 80